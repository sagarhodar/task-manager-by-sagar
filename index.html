<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tasker - Task Manager by Sagar</title>
    <meta name="description" content="A modern task management PWA by Sagar Hodar - Stay organized and productive offline" />
    <meta name="author" content="Sagar Hodar" />
    <meta name="keywords" content="task manager, todo app, productivity, Sagar Hodar, PWA" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Theme colors -->
    <meta name="theme-color" content="#3b82f6" />
    <meta name="msapplication-TileColor" content="#3b82f6" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/192x192.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/192x192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/512x512.png" />
    
    <!-- Apple PWA meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Tasker" />
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="/icons/192x192.png" />
    <meta name="msapplication-square70x70logo" content="/icons/192x192.png" />
    <meta name="msapplication-square150x150logo" content="/icons/192x192.png" />
    <meta name="msapplication-square310x310logo" content="/icons/512x512.png" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/192x192.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/192x192.png" />
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://accounts.google.com" />
    <link rel="preconnect" href="https://firebase.googleapis.com" />
    
    <!-- Prevent zoom on iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  </head>
  <body>
    <div id="root"></div>

    <!-- Loading screen for PWA (optional) -->
    <div id="loading-screen" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 50%, #f3e8ff 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    ">
      <div style="
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      ">
        <div style="color: white; font-size: 24px;">âœ…</div>
      </div>
      <h2 style="
        margin: 0 0 8px 0;
        font-size: 24px;
        font-weight: bold;
        background: linear-gradient(135deg, #1f2937, #4b5563);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      ">Tasker</h2>
      <p style="
        margin: 0 0 24px 0;
        color: #6b7280;
        font-size: 14px;
      ">by Sagar Hodar</p>
      <div style="
        width: 32px;
        height: 32px;
        border: 3px solid #e5e7eb;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      "></div>
    </div>

    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>

    <script type="module" src="/src/main.jsx"></script>

    <!-- Enhanced Service Worker Registration -->
    <script>
      // Hide loading screen once app is loaded
      window.addEventListener('load', () => {
        setTimeout(() => {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
            loadingScreen.style.opacity = '0';
            loadingScreen.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
              loadingScreen.remove();
            }, 500);
          }
        }, 1000);
      });

      // Enhanced Service Worker registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
              console.log('âœ… Tasker PWA: Service Worker registered successfully');
              console.log('Scope:', registration.scope);

              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('ðŸ”„ New version available. Please refresh.');
                    // You can show a notification to user here
                    if (confirm('New version of Tasker is available. Refresh to update?')) {
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch(error => {
              console.error('âŒ Tasker PWA: Service Worker registration failed:', error);
            });
        });

        // Listen for controllerchange event
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('ðŸ”„ Tasker PWA: New service worker activated');
        });
      }

      // PWA Install prompt
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('ðŸ’¡ Tasker PWA: Install prompt available');
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install button or notification
        showInstallPromotion();
      });

      function showInstallPromotion() {
        // You can create a custom install button here
        console.log('ðŸ“± Showing install promotion for Tasker PWA');
        
        // Simple install prompt after 5 seconds
        setTimeout(() => {
          if (deferredPrompt && confirm('Install Tasker as an app for better experience?')) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
              if (choiceResult.outcome === 'accepted') {
                console.log('âœ… User accepted the Tasker PWA install prompt');
              } else {
                console.log('âŒ User dismissed the Tasker PWA install prompt');
              }
              deferredPrompt = null;
            });
          }
        }, 5000);
      }

      // Track PWA usage
      window.addEventListener('appinstalled', (evt) => {
        console.log('ðŸŽ‰ Tasker PWA was installed successfully!');
      });

      // Detect if running as PWA
      if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('ðŸ“± Tasker is running as a PWA!');
        document.body.classList.add('pwa-mode');
      }

      // Online/Offline detection
      window.addEventListener('online', () => {
        console.log('ðŸŒ Tasker: Back online');
        document.body.classList.remove('offline-mode');
      });

      window.addEventListener('offline', () => {
        console.log('ðŸ“´ Tasker: Gone offline');
        document.body.classList.add('offline-mode');
      });
    </script>

    <!-- Additional CSS for PWA modes -->
    <style>
      .pwa-mode {
        /* Additional styles when running as PWA */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
      
      .offline-mode {
        /* Visual indicator when offline */
        position: relative;
      }
      
      .offline-mode::before {
        content: "ðŸ“´ Offline Mode";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #f59e0b;
        color: white;
        text-align: center;
        padding: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 10000;
      }
    </style>
  </body>
</html>